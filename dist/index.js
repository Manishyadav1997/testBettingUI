import u from"express";import p from"path";import{fileURLToPath as $}from"url";import{createServer as v}from"http";import{WebSocketServer as x,WebSocket as g}from"ws";async function f(a){let i=v(a);return new x({server:i,path:"/ws"}).on("connection",t=>{console.log("Client connected to WebSocket"),t.send(JSON.stringify({type:"welcome",message:"Connected to BetPro real-time updates"}));let r=[setInterval(()=>{t.readyState===g.OPEN&&t.send(JSON.stringify({type:"cricket_odds_update",data:{matchId:"1",odds:{team1Win:1.85+(Math.random()-.5)*.1,team2Win:2.1+(Math.random()-.5)*.1}}}))},3e3),setInterval(()=>{if(t.readyState===g.OPEN){let e=1+Math.random()*10;t.send(JSON.stringify({type:"aviator_update",data:{multiplier:e.toFixed(2),crashed:e>8}}))}},100),setInterval(()=>{if(t.readyState===g.OPEN){let e=Math.floor(Math.random()*60);t.send(JSON.stringify({type:"color_game_update",data:{countdown:e,round:1235+Math.floor(Date.now()/6e4)}}))}},1e3)];t.on("message",e=>{try{let o=JSON.parse(e.toString());switch(console.log("Received message:",o),o.type){case"place_bet":t.send(JSON.stringify({type:"bet_placed",data:{betId:Date.now().toString(),status:"success",message:"Bet placed successfully"}}));break;case"cash_out":t.send(JSON.stringify({type:"cash_out_success",data:{amount:o.amount,multiplier:o.multiplier}}));break}}catch(o){console.error("Error parsing WebSocket message:",o)}}),t.on("close",()=>{console.log("Client disconnected from WebSocket"),r.forEach(e=>clearInterval(e))}),t.on("error",e=>{console.error("WebSocket error:",e),r.forEach(o=>clearInterval(o))})}),a.get("/api/matches",async(t,r)=>{let e=[{id:"1",team1:"Mumbai Indians",team2:"Chennai Super Kings",status:"live",score:{team1Score:"178/4",team2Score:"0/0",overs:"18.4"},odds:{team1Win:1.85,team2Win:2.1},startTime:new Date().toISOString()},{id:"2",team1:"Royal Challengers Bangalore",team2:"Delhi Capitals",status:"live",score:{team1Score:"98/2",team2Score:"0/0",overs:"12.2"},odds:{team1Win:1.92,team2Win:1.98},startTime:new Date().toISOString()}];r.json(e)}),a.post("/api/bets",async(t,r)=>{try{let{gameType:e,betType:o,amount:n,odds:c}=t.body,l={id:Date.now().toString(),gameType:e,betType:o,amount:n,odds:c,status:"pending",createdAt:new Date().toISOString()};r.json({success:!0,bet:l})}catch{r.status(400).json({error:"Failed to place bet"})}}),a.get("/api/user/balance",async(t,r)=>{r.json({balance:12450})}),a.post("/api/user/deposit",async(t,r)=>{try{let{amount:e}=t.body;r.json({success:!0,newBalance:12450+e,transactionId:Date.now().toString()})}catch{r.status(400).json({error:"Deposit failed"})}}),a.get("/api/leaderboard",async(t,r)=>{let e=[{rank:1,username:"RajeshK***",game:"Aviator",amount:45670},{rank:2,username:"PriyaM***",game:"Color Trading",amount:23450},{rank:3,username:"ArunS***",game:"Cricket",amount:18230},{rank:4,username:"SnehaR***",game:"Mini Games",amount:15670},{rank:5,username:"VikasT***",game:"Aviator",amount:12890}];r.json(e)}),i}import O from"express";import b from"fs";import h from"path";import{createServer as w,createLogger as k}from"vite";import{nanoid as E}from"nanoid";var S=k();async function y(a,i){let s=await w({configFile:h.resolve(import.meta.dirname,"../vite.config.ts"),server:{middlewareMode:!0,hmr:{server:i,port:24678,clientPort:24678,protocol:"ws",host:"localhost"}},appType:"custom",customLogger:{...S,error:(t,r)=>{S.error(t,r),process.exit(1)}}});a.use(s.middlewares),a.use("*",async(t,r,e)=>{let o=t.originalUrl;try{let n=h.resolve(import.meta.dirname,"..","client","index.html"),c=await b.promises.readFile(n,"utf-8");c=c.replace('src="/src/main.tsx"',`src="/src/main.tsx?v=${E()}"`);let l=await s.transformIndexHtml(o,c);r.status(200).set({"Content-Type":"text/html"}).end(l)}catch(n){s.ssrFixStacktrace(n),e(n)}})}import _ from"fs/promises";var W=$(import.meta.url),V=p.dirname(W);function d(a,i="express"){let s=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${s} [${i}] ${a}`)}var m=u();m.use(u.json());m.use(u.urlencoded({extended:!1}));m.use((a,i,s)=>{let t=Date.now(),r=a.path,e,o=i.json;i.json=function(n,...c){return e=n,o.apply(i,[n,...c])},i.on("finish",()=>{let n=Date.now()-t;if(r.startsWith("/api")){let c=`${a.method} ${r} ${i.statusCode} in ${n}ms`;e&&(c+=` :: ${JSON.stringify(e)}`),c.length>80&&(c=c.slice(0,79)+"\u2026"),d(c)}}),s()});(async()=>{let a=await f(m);if(m.use((s,t,r,e)=>{let o=s.status||s.statusCode||500,n=s.message||"Internal Server Error";throw r.status(o).json({message:n}),s}),m.get("env")==="development")await y(m,a);else{let s=p.resolve(process.cwd(),"dist"),t="/testBettingUI";d(`Serving static files from: ${s}`);try{let r=await _.readdir(s);d(`Files in dist directory: ${r.join(", ")}`);let e=u.Router();e.use(u.static(s,{index:!1,maxAge:"1y",etag:!0,lastModified:!0,setHeaders:(o,n)=>{n.endsWith(".html")&&(o.setHeader("Cache-Control","no-cache, no-store, must-revalidate"),o.setHeader("Pragma","no-cache"),o.setHeader("Expires","0"))}})),e.get(["/","/*"],(o,n,c)=>{if(o.path.startsWith("/api"))return c();d(`Serving index.html for route: ${o.path}`),n.sendFile(p.join(s,"index.html"),l=>{l&&(d(`Error serving index.html: ${l.message}`,"error"),n.status(500).send("Error loading the application"))})}),m.use(t,e),process.env.NODE_ENV!=="production"&&(m.use(u.static(s)),m.get("*",(o,n)=>{n.sendFile(p.join(s,"index.html"))}))}catch(r){let e=r instanceof Error?r.message:"Unknown error";d(`Error setting up static file serving: ${e}`,"error"),process.exit(1)}}let i=3e3;a.listen(i,"127.0.0.1",()=>{d(`Server running at http://127.0.0.1:${i}`)})})();
//# sourceMappingURL=index.js.map
